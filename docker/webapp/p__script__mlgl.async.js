(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[97],{AdWZ:function(e,t,a){"use strict";a.r(t);a("bbsP");var l=a("/wGt"),n=(a("g9YV"),a("wCAj")),r=(a("Pwec"),a("CtXQ")),i=(a("+L6B"),a("2/Rp")),o=a("jehZ"),s=a.n(o),c=(a("/zsF"),a("PArb")),d=(a("+BJd"),a("mr32")),u=(a("5Dmo"),a("3S7+")),p=(a("miYZ"),a("tsqr")),m=a("gWZ8"),h=a.n(m),f=a("2Taf"),y=a.n(f),g=a("vZ4D"),w=a.n(g),E=a("l4Ni"),b=a.n(E),v=a("ujKo"),R=a.n(v),k=a("MhPg"),_=a.n(k),x=(a("2qtc"),a("kLXV")),S=(a("5NDa"),a("5rEg")),C=(a("OaEy"),a("2fM7")),D=(a("y8nQ"),a("Vl3Y")),L=a("q1tI"),F=a.n(L),V=a("lZ7h"),A=a.n(V),T=(a("wd/R"),a("CyYT")),J=a("BMLG"),N=a("MuoO"),M=a("P4xi"),W=a("6Hmz"),j=W["a"].WebFW_MLGL_CX.key,q=W["a"].WebFW_MLGL_AddDir.key,I=W["a"].WebFW_MLGL_DirName.key,G=W["a"].WebFW_MLGL_Edit.key,Z=W["a"].WebFW_MLGL_SC.key,O=D["a"].Item,B=(C["a"].Option,S["a"].TextArea),P=(x["a"].confirm,function(e){function t(){var e,a;y()(this,t);for(var l=arguments.length,n=new Array(l),r=0;r<l;r++)n[r]=arguments[r];return a=b()(this,(e=R()(t)).call.apply(e,[this].concat(n))),a.state={visible:!1,type:null,drawerTitle:null,loading:!0,listDir:[],dataDir:null,roleType:null,jsglVisible:!1,readRole:[],writeRole:[],edit_readRole:[],edit_writeRole:[],rolesList:[]},a.query=function(){a.props.dispatch({type:"mlgl/listDir",payload:{name:null,skip:0,limit:0},callback:function(e){if("0"!=e.code)return a.setState({loading:!1}),p["a"].error("\u67e5\u8be2\u76ee\u5f55\u5217\u8868\u9519\u8bef\uff1a".concat(e.data));var t=e.data[1],l=[];t.map(function(e){var t=e.read,a=e.write;e.path;t&&l.push.apply(l,h()(t)),a&&l.push.apply(l,h()(a))}),a.queryNameById(l),setTimeout(function(){a.setState({loading:!1,listDir:t})},100)}})},a.queryNameById=function(e){e=Array.from(new Set(e));var t=[];e.map(function(e){var l=e.split(":");a.props.dispatch({type:"mlgl/getRoles",payload:{domain:l[0],nodes:[l[1]]},callback:function(e){0==e.code&&(e.data[0]&&t.push(e.data[0]),a.setState({rolesList:t}))}})})},a.del=function(e){var t=a.props.dispatch;x["a"].confirm({title:"\u786e\u8ba4\u5220\u9664 '".concat(e.name,"' \u5417?"),content:"",okText:"\u662f",okType:"danger",cancelText:"\u5426",onOk:function(){t({type:"mlgl/delDir",payload:{id:e._id},callback:function(e){"0"==e.code?(a.query(),p["a"].success("\u5220\u9664\u6210\u529f\uff01")):p["a"].error("\u5220\u9664\u5931\u8d25 \uff01".concat(e.data))}})},onCancel:function(){}})},a.reset=function(){a.props.form.resetFields(),a.query(),p["a"].success("\u91cd\u7f6e\u6210\u529f")},a.handleRoles=function(e){var t=a.state.rolesList,l={},n=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var c=o.value;if(c._id==e)return l._id=c._id,l.name=c.name,l}}catch(e){r=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}return l._id=e,l.name=e,l},a.openDrawer=function(e,t,l){a.props.dispatch;if(console.log("===data==",l),l){var n=l.read,r=l.write,i=[],o=[];n&&n.map(function(e){i.push(a.handleRoles(e))}),r&&r.map(function(e){o.push(a.handleRoles(e))}),setTimeout(function(){a.setState({visible:!0,type:e,drawerTitle:t,dataDir:l,edit_readRole:i,edit_writeRole:o})},100)}else a.setState({visible:!0,type:e,drawerTitle:t})},a.drawerClose=function(){a.setState({visible:!1,type:null,drawerTitle:null})},a.getJsglMsg=function(e){console.log("\u6dfb\u52a0role",e);var t=a.state.roleType;"readRole"==t?a.setState({readRole:e}):"writeRole"==t?a.setState({writeRole:e}):"edit_readRole"==t?a.setState({edit_readRole:e}):"edit_writeRole"==t&&a.setState({edit_writeRole:e}),a.setState({jsglVisible:!1})},a.closeJsgl=function(){a.setState({jsglVisible:!1})},a.showJsgl=function(e){console.log(e),a.setState({jsglVisible:!0,roleType:e})},a.handleSearch=function(){var e=a.props,t=e.dispatch,l=e.form,n=l.getFieldValue("cx_name");t({type:"mlgl/listDir",payload:{name:n||null,skip:0,limit:0},callback:function(e){if("0"!=e.code)return p["a"].error("\u67e5\u8be2\u76ee\u5f55\u5217\u8868\u9519\u8bef\uff1a".concat(e.data));a.setState({listDir:e.data[1]}),p["a"].success("\u67e5\u8be2\u6210\u529f")}})},a.handleSubmit=function(){var e=a.props,t=e.dispatch,l=e.form,n=a.state,r=n.type,i=n.dataDir,o=n.readRole,s=n.writeRole,c=n.edit_readRole,d=n.edit_writeRole,u=n.listDir,m=l.getFieldValue("name")?l.getFieldValue("name"):null,h=l.getFieldValue("path")?l.getFieldValue("path"):null,f=l.getFieldValue("desc")?l.getFieldValue("desc"):null,y=[],g=[];if(u.forEach(function(e){y.push(e.name),g.push(e.path)}),"01"==r){var w=[],E=[];if(o.map(function(e){w.push(e._id)}),s.map(function(e){E.push(e._id)}),null==m)return p["a"].warning("\u6743\u9650\u540d\u79f0\u5fc5\u586b\uff01");if(y.includes(m))return p["a"].warning("\u76ee\u5f55\u6620\u5c04\u540d\u79f0\u5df2\u7ecf\u5b58\u5728\uff0c\u6dfb\u52a0\u5931\u8d25\uff01");if(null==h)return p["a"].warning("\u771f\u5b9e\u8def\u5f84\u5fc5\u586b\uff01");if(g.includes(h))return p["a"].warning("\u76ee\u5f55\u771f\u5b9e\u8def\u5f84\u5df2\u7ecf\u5b58\u5728\uff0c\u6dfb\u52a0\u5931\u8d25\uff01");t({type:"mlgl/setDir",payload:{dir:{name:m,desc:f,path:h,read:w.length>0?w:null,write:E.length>0?E:null}},callback:function(e){"0"==e.code?(a.query(),p["a"].success("\u6dfb\u52a0\u6210\u529f\uff01"),a.setState({visible:!1,readRole:[],writeRole:[]})):p["a"].error("\u6dfb\u52a0\u5931\u8d25 \uff01".concat(e.data))}})}if("02"==r){var b=[],v=[];if(c.map(function(e){b.push(e._id)}),d.map(function(e){v.push(e._id)}),i.name==m);else if(y.includes(m))return p["a"].warning("\u76ee\u5f55\u6620\u5c04\u540d\u79f0\u5df2\u7ecf\u5b58\u5728\uff0c\u4fee\u6539\u5931\u8d25\uff01");if(g.includes(h))return p["a"].warning("\u76ee\u5f55\u771f\u5b9e\u8def\u5f84\u5df2\u7ecf\u5b58\u5728\uff0c\u4fee\u6539\u5931\u8d25\uff01");console.log("\u7f16\u8f91",b,v),t({type:"mlgl/setDir",payload:{dir:{_id:i._id,name:m||i.name,path:i.path,desc:f||i.desc,read:b.length>0?b:null,write:v.length>0?v:null}},callback:function(e){"0"==e.code?(a.query(),p["a"].success("\u4fee\u6539\u6210\u529f\uff01"),a.setState({visible:!1})):p["a"].error("\u4fee\u6539\u5931\u8d25 \uff01".concat(e.data))}})}},a.handle=function(e){var t=a.state.rolesList,l=!0,n=!1,r=void 0;try{for(var i,o=t[Symbol.iterator]();!(l=(i=o.next()).done);l=!0){var s=i.value;if(s._id==e)return s.name}}catch(e){n=!0,r=e}finally{try{l||null==o.return||o.return()}finally{if(n)throw r}}return e},a}return _()(t,e),w()(t,[{key:"componentDidMount",value:function(){this.query()}},{key:"handleChange",value:function(e,t){console.log("\u5220\u9664role",e);var a=this.state,l=a.readRole,n=a.writeRole,r=a.edit_readRole,i=a.edit_writeRole;if("readRole"==t){var o=[];e.map(function(e){l.map(function(t){e==t.name&&o.push(t)})}),this.setState({readName:e,readRole:o})}else if("writeRole"==t){var s=[];e.map(function(e){n.map(function(t){e==t.name&&s.push(t)})}),this.setState({writeName:e,writeRole:s})}else if("edit_readRole"==t){var c=[];e.map(function(e){r.map(function(t){e==t.name&&c.push(t)})}),this.setState({edit_readName:e,edit_readRole:c})}else if("edit_writeRole"==t){var d=[];e.map(function(e){i.map(function(t){e==t.name&&d.push(t)})}),this.setState({edit_writeRole:d})}}},{key:"render",value:function(){var e=this,t=this.props.form.getFieldDecorator,a=this.state,o=a.dataDir,p=a.readRole,m=a.writeRole,h=a.edit_readRole,f=a.edit_writeRole,y=a.roleType,g=[{title:"\u76ee\u5f55\u6620\u5c04\u540d\u79f0",render:function(t){return F.a.createElement("span",null,F.a.createElement("a",{style:{userSelect:"none"},onClick:function(a){a&&a.preventDefault(),M["a"].checkAuthAndExecute(e.props.dispatch,I,function(){return e.openDrawer("03","\u6587\u4ef6\u5939\u7ba1\u7406",t)},[null])}},t.name))}},{title:"\u771f\u5b9e\u8def\u5f84",dataIndex:"path",render:function(e){return F.a.createElement(u["a"],{placement:"top",title:"\u771f\u5b9e\u8def\u5f84\uff1a".concat(void 0==e?"":e)},e)}},{title:"\u6620\u5c04\u8bf4\u660e",dataIndex:"desc",align:"center",render:function(e){return F.a.createElement(u["a"],{placement:"top",title:"\u6620\u5c04\u8bf4\u660e\uff1a".concat(void 0==e?"":e)},e)}},{title:"\u53ef\u8bfb\u7684\u89d2\u8272",dataIndex:"read",align:"center",width:"25%",render:function(t){return F.a.createElement("span",null,t?t.map(function(t){return F.a.createElement(d["a"],{color:"red"},e.handle(t))}):[])}},{title:"\u53ef\u5199\u7684\u89d2\u8272",dataIndex:"write",width:"25%",align:"center",render:function(t){return t?t.map(function(t){return F.a.createElement(d["a"],{color:"red"},e.handle(t))}):[]}},{title:"\u64cd\u4f5c",align:"center",width:"10%",render:function(t){return F.a.createElement("span",null,F.a.createElement("a",{onClick:function(a){a&&a.preventDefault(),M["a"].checkAuthAndExecute(e.props.dispatch,G,function(){return e.openDrawer("02","\u7f16\u8f91",t)},[null])}},"\u7f16\u8f91"),F.a.createElement(c["a"],{type:"vertical"}),F.a.createElement("a",{onClick:function(a){a&&a.preventDefault(),M["a"].checkAuthAndExecute(e.props.dispatch,Z,function(){return e.del(t)},[null])}},"\u5220\u9664"))}}],w={labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}},E=F.a.createElement(F.a.Fragment,null,"01"==this.state.type?F.a.createElement(D["a"],s()({},w,{onSubmit:this.handleSubmit}),F.a.createElement(O,{label:F.a.createElement("span",{style:{width:"100px",display:"inline-block"}},"\u76ee\u5f55\u6620\u5c04\u540d\u79f0 ")},t("name")(F.a.createElement("div",null,F.a.createElement(S["a"],{placeholder:"\u8bf7\u8f93\u5165\u76ee\u5f55\u6620\u5c04\u540d\u79f0",style:{width:330}}),F.a.createElement("span",{style:{color:"red",marginLeft:5}},"*")))),F.a.createElement(O,{label:F.a.createElement("span",{style:{width:"80px",display:"inline-block"}},"\u771f\u5b9e\u8def\u5f84 ")},t("path")(F.a.createElement("div",null,F.a.createElement(S["a"],{placeholder:"\u8bf7\u8f93\u5165\u771f\u5b9e\u8def\u5f84",style:{width:330}}),F.a.createElement("span",{style:{color:"red",marginLeft:5}},"*")))),F.a.createElement(O,{label:F.a.createElement("span",{style:{width:"80px",display:"inline-block"}},"\u6620\u5c04\u8bf4\u660e ")},t("desc")(F.a.createElement(B,{placeholder:"\u8bf7\u8f93\u5165\u6620\u5c04\u8bf4\u660e",style:{width:330}}))),F.a.createElement(O,{label:F.a.createElement("span",{style:{width:"100px",display:"inline-block"}},"\u53ef\u8bfb\u7684\u89d2\u8272 ")},F.a.createElement(C["a"],{mode:"tags",style:{width:330},placeholder:"\u8bf7\u9009\u62e9\u89d2\u8272\uff01",onFocus:function(){return e.showJsgl("readRole")},dropdownStyle:{display:"none"},onChange:function(t){e.handleChange(t,"readRole")},allowClear:!0,value:p?p.map(function(e){return e.name}):void 0})),F.a.createElement(O,{label:F.a.createElement("span",{style:{width:"100px",display:"inline-block"}},"\u53ef\u5199\u7684\u89d2\u8272 ")},F.a.createElement(C["a"],{mode:"tags",style:{width:330},placeholder:"\u8bf7\u9009\u62e9\u89d2\u8272\uff01",onFocus:function(){return e.showJsgl("writeRole")},dropdownStyle:{display:"none"},onChange:function(t){e.handleChange(t,"writeRole")},allowClear:!0,value:m?m.map(function(e){return e.name}):void 0}))):"02"==this.state.type?F.a.createElement(D["a"],s()({},w,{onSubmit:this.handleSubmit}),F.a.createElement(O,{label:F.a.createElement("span",{style:{width:"100px",display:"inline-block"}},"\u76ee\u5f55\u6620\u5c04\u540d\u79f0")},t("name")(F.a.createElement("div",null,F.a.createElement(S["a"],{placeholder:"\u8bf7\u8f93\u5165\u76ee\u5f55\u6620\u5c04\u540d\u79f0",defaultValue:o&&o.name,style:{width:330}}),F.a.createElement("span",{style:{color:"red",marginLeft:5}},"*")))),F.a.createElement(O,{label:F.a.createElement("span",{style:{width:"80px",display:"inline-block"}},"\u771f\u5b9e\u8def\u5f84")},t("path")(F.a.createElement("div",null,F.a.createElement(S["a"],{placeholder:"\u8bf7\u8f93\u5165\u771f\u5b9e\u8def\u5f84",defaultValue:o&&o.path,style:{width:330},disabled:!0}),F.a.createElement("span",{style:{color:"red",marginLeft:5}},"*")))),F.a.createElement(O,{label:F.a.createElement("span",{style:{width:"80px",display:"inline-block"}},"\u6620\u5c04\u8bf4\u660e")},t("desc")(F.a.createElement("div",null,F.a.createElement(B,{placeholder:"\u8bf7\u8f93\u5165\u6620\u5c04\u8bf4\u660e",defaultValue:o&&o.desc,style:{width:330}})))),F.a.createElement(O,{label:F.a.createElement("span",{style:{width:"100px",display:"inline-block"}},"\u53ef\u8bfb\u7684\u89d2\u8272 ")},F.a.createElement(C["a"],{mode:"tags",style:{width:330},placeholder:"\u8bf7\u9009\u62e9\u89d2\u8272\uff01",onFocus:function(){return e.showJsgl("edit_readRole")},dropdownStyle:{display:"none"},onChange:function(t){e.handleChange(t,"edit_readRole")},allowClear:!0,value:h?h.map(function(e){return e.name}):void 0})),F.a.createElement(O,{label:F.a.createElement("span",{style:{width:"100px",display:"inline-block"}},"\u53ef\u5199\u7684\u89d2\u8272 ")},F.a.createElement(C["a"],{mode:"tags",style:{width:330},placeholder:"\u8bf7\u9009\u62e9\u89d2\u8272\uff01",onFocus:function(){return e.showJsgl("edit_writeRole")},dropdownStyle:{display:"none"},onChange:function(t){e.handleChange(t,"edit_writeRole")},allowClear:!0,value:f?f.map(function(e){return e.name}):void 0}))):F.a.createElement(J["a"],{data:o}));return F.a.createElement("div",null,F.a.createElement("div",{className:A.a.header},F.a.createElement(D["a"],{onSubmit:this.handleSearch,layout:"inline"},F.a.createElement("div",{className:A.a.search},F.a.createElement("div",{className:A.a.cols},F.a.createElement(O,{label:F.a.createElement("span",{style:{width:"100px",display:"inline-block"}},"\u76ee\u5f55\u6620\u5c04\u540d")},t("cx_name")(F.a.createElement(S["a"],{placeholder:"\u8bf7\u8f93\u76ee\u5f55\u6620\u5c04\u540d",style:{width:330}})))),F.a.createElement("div",null,F.a.createElement(i["a"],{type:"primary",onClick:function(t){t&&t.preventDefault(),M["a"].checkAuthAndExecute(e.props.dispatch,j,function(){return e.handleSearch()},[null])}},"\u67e5\u8be2"),F.a.createElement(i["a"],{style:{marginLeft:8},onClick:this.reset},"\u91cd\u7f6e"))))),F.a.createElement("div",{className:A.a.content},F.a.createElement("div",{className:A.a.btns},F.a.createElement(i["a"],{type:"primary",onClick:function(t){t&&t.preventDefault(),M["a"].checkAuthAndExecute(e.props.dispatch,q,function(){return e.openDrawer("01","\u589e\u52a0\u76ee\u5f55\u6620\u5c04")},[null])}},F.a.createElement(r["a"],{type:"plus"}),"\u589e\u52a0\u76ee\u5f55\u6620\u5c04")),F.a.createElement("div",null,F.a.createElement(n["a"],{columns:g,dataSource:this.state.listDir,loading:this.state.loading,size:"small",pagination:15}))),F.a.createElement(l["a"],{title:F.a.createElement(F.a.Fragment,null,this.state.drawerTitle),onClose:this.drawerClose,visible:this.state.visible,destroyOnClose:!0},E,"03"!=this.state.type?F.a.createElement("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right"}},F.a.createElement(i["a"],{onClick:this.drawerClose,style:{marginRight:8}},"\u53d6\u6d88"),F.a.createElement(i["a"],{type:"primary",onClick:this.handleSubmit},"\u786e\u5b9a")):null),this.state.jsglVisible?F.a.createElement(T["a"],{jsglVisible:this.state.jsglVisible,handleSelectedJsgl:this.getJsglMsg.bind(this),handleJsglVisible:this.closeJsgl.bind(this),selectName:y&&"readRole"==y?p:"writeRole"==y?m:"edit_writeRole"==y?f:h}):null)}}]),t}(L["Component"]));t["default"]=Object(N["connect"])(function(e){return e.mlgl})(D["a"].create()(P))},lZ7h:function(e,t,a){e.exports={header:"antd-pro-pages-script-mlgl-index-header",search:"antd-pro-pages-script-mlgl-index-search",cols:"antd-pro-pages-script-mlgl-index-cols",content:"antd-pro-pages-script-mlgl-index-content",btns:"antd-pro-pages-script-mlgl-index-btns",bar:"antd-pro-pages-script-mlgl-index-bar",back:"antd-pro-pages-script-mlgl-index-back",drawer:"antd-pro-pages-script-mlgl-index-drawer"}}}]);